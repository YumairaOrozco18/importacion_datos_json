---
title: "datos json"
author: "Yumaira Orozco"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float:
      smooth_scroll: true
      collapsed: true
    number_sections: true
    theme: darkly 
    highlight: kate
    df_print: paged
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r datos, echo=FALSE, warning=FALSE}
# Cargar las librerías necesarias
library(httr)
library(jsonlite)
library(dplyr)
library(ggplot2)
library(tidyr)

base <- "https://api.covidactnow.org/v2/states.json?"
apiKey <- "f9780f7ec7774d169b4543c489d876bd"
url <- paste0(base, "apiKey=", apiKey)  # Asegúrate de que el parámetro de la API esté correctamente formateado

response <- GET(url)

# Verificar que la solicitud fue exitosa
if (status_code(response) != 200) {
  stop("Error en la solicitud: ", status_code(response))
}

COVID_list <- fromJSON(rawToChar(response$content), flatten = TRUE)

# Verificar la estructura de los datos
print(names(COVID_list)) # para ver qué columnas están disponibles

df <- data.frame(
  state = COVID_list$state,
  population = COVID_list$population
)

# Verificar que el data frame se creó correctamente
print(head(df))

# Verificar que las columnas existan
if (!all(c("state", "population") %in% colnames(df))) {
  stop("Las columnas 'state' y 'population' no existen en el data frame.")
}
```

```{r echo=FALSE, warning=FALSE}
ggplot(df, aes(x = state, y = population)) +
  geom_bar(stat = "identity", fill = "blue") +
  theme_minimal() +
  labs(title = "Población por estado",
       x = "Estado",
       y = "Población") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

